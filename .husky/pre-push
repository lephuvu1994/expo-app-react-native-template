# Get current branch name
current_branch=$(git symbolic-ref --short HEAD)

# Check protected branches
protected_branches="develop main master"

for branch in $protected_branches; do
  if [ "$current_branch" = "$branch" ]; then
    echo "‚ùå Direct push to $branch is not allowed!"
    echo "Please create a pull request instead."
    exit 1
  fi
done

# Validate branch name pattern
if ! echo "$current_branch" | grep -qE '^[a-z0-9]+/(feature|bugfix|hotfix|refactor|release)/NOS-[0-9]+-[a-zA-Z0-9-]+$'; then
  echo "‚ùå Invalid branch name!"
  echo "Branch name should follow the pattern: [author]/[branch type]/[JIRA_ID]-description-here"
  echo "Example: jack/feature/NOS-1001-add-login"
  exit 1
fi

# Run yarn build to ensure code builds successfully
echo "üî® Running yarn build..."
if ! yarn build; then
  echo "‚ùå Build failed! Please fix build errors before pushing."
  exit 1
fi
echo "‚úÖ Build successful!"
